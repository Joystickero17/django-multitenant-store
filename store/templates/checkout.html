{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- SECTION -->
<div id="app" class="section">
	<!-- container -->
	<div class="container">
		<!-- row -->
		<div class="row">

			<div class="col-md-7">
				<!-- Billing Details -->
				<div class="billing-details">
					<div class="section-title">
						<h3 class="title">Dirección de Facturación</h3>
						
					</div>
					<div :class="{'d-block': use_different_info, 'd-none':!use_different_info}">
						<div class="form-group">
							<input v-model="checkout_form.main_sending_address.name" class="form-control my-1 input" type="text" name="first-name" placeholder="Nombre">
						</div>
						<div class="form-group">
							<input v-model="checkout_form.main_sending_address.last_name" class="form-control my-1 input" type="text" name="last-name" placeholder="Apellido">
						</div>
					</div>
					
					<div class="form-group">
						<textarea v-model="checkout_form.main_sending_address.short_address" class="form-control my-1 input" type="text" name="address" placeholder="Dirección corta"></textarea>
					</div>
					<div class="form-group">
						<input v-model="checkout_form.main_sending_address.estado" class="form-control my-1 input" type="text" placeholder="Estado">
					</div>
					<div class="form-group">
						<input v-model="checkout_form.main_sending_address.city" class="form-control my-1 input" type="text" placeholder="Ciudad">
					</div>
					<div class="form-group">
						<input v-model="checkout_form.main_sending_address.localidad" class="form-control my-1 input" type="text" placeholder="Localidad">
					</div>
					<div class="form-group">
						<input v-model="checkout_form.secondary_sending_address.zip_code" class="form-control my-1 input" type="text" name="zip-code" placeholder="Código postal">
					</div>
					<div class="form-group">
						<input v-model="checkout_form.main_sending_address.phone_number" class="form-control my-1 input" type="tel" name="tel" placeholder="Numero telefónico">
					</div>
				</div>
				<!-- /Billing Details -->

				<!-- Shiping Details -->
				<div class="shiping-details">
					<div class="section-title">
						<h3 class="title">Dirección de Envío</h3>
					</div>
					<div class="input-checkbox">
						<input type="checkbox" v-model="use_secondary_address" id="shiping-address">
						<label for="shiping-address">
							<span></span>
							¿Enviarás a una dirección distinta?
						</label>
						<div class="caption">
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.name" class="form-control my-1 input" type="text" name="first-name" placeholder="Nombre">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.last_name" class="form-control my-1 input" type="text" name="last-name" placeholder="Apellido">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.short_address" class="form-control my-1 input" type="text" name="address" placeholder="Dirección corta">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.estado" class="form-control my-1 input" type="text" placeholder="Estado">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.city" class="form-control my-1 input" type="text" placeholder="Ciudad">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.localidad" class="form-control my-1 input" type="text" placeholder="Localidad">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.zip_code" class="form-control my-1 input" type="text" name="zip-code" placeholder="Código postal">
							</div>
							<div class="form-group">
								<input v-model="checkout_form.secondary_sending_address.phone_number" class="form-control my-1 input" type="tel" name="tel" placeholder="Numero telefónico">
							</div>
						</div>
					</div>
				</div>
				<!-- /Shiping Details -->

				<!-- Order notes -->
				<div class="order-notes">
					<small>Mencionar si hay algo que se debe hacer al momento de la entrega</small>
					<textarea class="input" placeholder="Observaciones de la Compra"></textarea>
				</div>
				<!-- /Order notes -->
			</div>

			<!-- Order Details -->
			<div class="col-md-5 order-details">
				<div class="section-title text-center">
					<h3 class="title">Tu orden</h3>
				</div>
				<div class="order-summary">
					<div class="order-col">
						<div><strong>PRODUCTO</strong></div>
						<div><strong>TOTAL</strong></div>
					</div>
					<div class="order-products">
						<div class="order-col" v-for="item in cartItems">
							<div>[[item.quantity]]x [[item.product_details.name]]</div>
							<div>$[[item.quantity*item.product_details.price]]</div>
						</div>
					</div>
					<div class="order-col">
						<div>Envío</div>
						<div><strong>Gratis</strong></div>
					</div>
					<div class="order-col">
						<div><strong>TOTAL</strong></div>
						<div><strong class="order-total">$[[cartItemsTotal]]</strong></div>
					</div>
				</div>
				<div class="payment-method">
					<div class="input-radio">
						<input type="radio"  v-model="checkout_form.payment_type" value="pago_movil" name="payment" id="payment-1">
						<label for="payment-1">
							<span></span>
							Pago Movil
						</label>
						<div class="caption">
							<p>Al pagar se redirigira a una pagina para colocar la referencia de la operacion, una vez confirmada por nuestros operadores se procedera al envio.</p>
						</div>
					</div>
					<div class="input-radio">
						<input type="radio"  v-model="checkout_form.payment_type" name="payment" value="paypal" id="payment-2">
						<label for="payment-2">
							<span></span>
							Paypal
						</label>
						<div class="caption">
							<p>Te redirigira a la pagina de paypal para realizar el pago de la compra.</p>
						</div>
					</div>
					<div class="input-radio">
						<input type="radio"  v-model="checkout_form.payment_type" value="coinbase" name="payment" id="payment-3">
						<label for="payment-3">
							<span></span>
							Coinbase (Crypto)
						</label>
						<div class="caption">
							<p>Puedes pagar con una amplia variedad de criptomonedas gracias a coinbase commerce.</p>
							<p><a href="#crypto_options" @click="seeCryptoOptions">Click aqui para ver las monedas aceptadas.</a></p>
							<ul id="crypto_options" :class="{'d-block': show_crypto_options, 'd-none':!show_crypto_options}">
								<li>USDT</li>
								<li>BTC</li>
								<li>Bitcoin Cash</li>
								<li>Ethereum</li>
								<li>LTC</li>
								<li>DOGE</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="input-checkbox">
					<input type="checkbox" v-model="accept_conditions" id="terms">
					<label for="terms">
						<span></span>
						leí y acepto los <a href="#">Términos y condiciones</a>
					</label>
					
				</div>
				<div class="input-checkbox mt-2">
					<input type="checkbox" v-model="save_billing_info" id="save_shipping_info">
					<label for="save_shipping_info">
						<span></span>
						Usar la informacion suministrada para futuras compras
					</label>
				</div>
				<button href="" @click="goToPay" class="primary-btn order-submit d-block w-100">Finalizar Compra</button>
			</div>
			<!-- /Order Details -->
		</div>
		<!-- /row -->
	</div>
	<!-- /container -->
</div>
<!-- /SECTION -->
<script>
const app = new Vue({
	delimiters: ["[[","]]"],
	el: "#app",
	data(){
		return{
			cartItems: [],
			cartItemsTotal:0,
			loading: true,
			total_pages_items:0,
			save_billing_info: false,
			use_secondary_address: false,
			use_different_info: false,
			next_page: null,
			show_crypto_options:false,
			previous_page: null,
			accept_conditions: false,
			product_count: 0,
			checkout_form: {
				errors:[],
				main_sending_address:{
					name: "",
					last_name: "",
					short_address: "",
					estado: "",
					city: "",
					localidad: "",
					zip_code:"",
					phone_number: "",
				},
				secondary_sending_address:{
					name: "",
					last_name: "",
					short_address: "",
					estado: "",
					city: "",
					localidad: "",
					zip_code: "",
					phone_number: "",
				},
				payment_type: "",
				message: null,

			}

		}
	},
	methods: {
		seeCryptoOptions(){
			this.show_crypto_options = !this.show_crypto_options
			console.log(this.show_crypto_options)
		},
		checkForm(){
			this.checkout_form.errors = []
			if (!this.accept_conditions){
				this.checkout_form.errors.push("Debe aceptar los Terminos y Condiciones")
			}
			console.log(JSON.stringify(this.checkout_form, null,2))
			return !this.checkout_form.errors
		},	
		getCartItems(){
			axios.get("/api/cart/").then(data=>{
				this.cartItems = data.data.results
				this.cartItemsTotal = Array.from(data.data.results).reduce((a, item)=>{
					return (item.product_details.price||0) *item.quantity + a
				},0)
				console.log(this.cartItemsTotal)
			})
		},
		goToPay(){
			console.log(this.checkForm())
			if (this.checkout_form.payment_type == "coinbase"){
				console.log("coinbase")
			}
		},
		getUserInfo(){
			axios.get("/api/user/")
			.then((res)=>{
				if (!(res.data.name||res.data.last_name)){
					this.use_different_info = true
					return
				}
				this.checkout_form.name = res.name
				this.checkout_form.last_name = res.last_name
				this.checkout_form.email = res.email
			})
		}
	},
	mounted(){
		this.getCartItems()
		this.getUserInfo()
	}
})

</script>
{% endblock %}
