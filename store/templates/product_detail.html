{% extends "base.html" %}
{% load static %}
{% block content %}
		<!-- SECTION -->
		<div class="section" id="app">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<!-- Product main img -->
					
					<div class="col-md-5 col-md-push-2">

						<div id="product-main-img">
							<div class="product-preview">
								<img src="{% if object.thumbnail %}{{object.thumbnail.url}}{% else %}{% static 'img/no-photo.png' %}{% endif %}" alt="">
							</div>
							{% for img in object.photos.all %}
								<div class="product-preview">
									<img src="{% if img.file %}{{img.file.url}}{% else %}{% static 'img/no-photo.png' %}{% endif %}" alt="">
								</div>
							{% endfor %}
						</div>
					</div>
					<!-- /Product main img -->

					<!-- Product thumb imgs -->
					<div class="col-md-2  col-md-pull-5">
						<div id="product-imgs">
							<div class="product-preview">
								<img src="{% if object.thumbnail %}{{object.thumbnail.url}}{% else %}{% static 'img/no-photo.png' %}{% endif %}" alt="">
							</div>
							{% for img in object.photos.all %}
								<div class="product-preview">
									<img src="{% if img.file %}{{img.file.url}}{% else %}{% static 'img/no-photo.png' %}{% endif %}" alt="">
								</div>
							{% endfor %}
						</div>
					</div>
					<!-- /Product thumb imgs -->

					<!-- Product details -->
					<div class="col-md-5">
						<div class="product-details">
							<h2 class="product-name">{{object.name}}</h2>
							<div>
								
								<div class="product-rating">
								{% for score in score_range %}
									<i class="fa fa-star"></i>
								{% endfor %}
								{% for score in score_range_left %}
									<i class="fa fa-star-o"></i>
								{% endfor %}
								</div>
								<a class="review-link" href="#">{{object.reviews.count}} Reseña(s) | Agrega tu Reseña</a>
							</div>
							<div>
								<h3 class="product-price">${{object.price}} {% if object.get_discount %}<del class="product-old-price">$990.00</del>{% endif %}</h3>
								<span class="product-available">En Stock</span>
							</div>
							<p>{{object.description}}</p>

							<div class="product-options">
								<label>
									Size
									<select class="input-select">
										<option value="0">X</option>
									</select>
								</label>
								<label>
									Color
									<select class="input-select">
										<option value="0">Rojo</option>
									</select>
								</label>
							</div>

							<div class="add-to-cart">
								<div class="qty-label">
									Qty
									<div class="input-number">
										<input type="number">
										<span class="qty-up">+</span>
										<span class="qty-down">-</span>
									</div>
								</div>
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> Agregar al Carrito</button>
							</div>

							<ul class="product-btns">
								<li><a href="#"><i class="fa fa-heart-o"></i> Agregar a lista de deseos</a></li>
								<li><a href="#"><i class="fa fa-exchange"></i> Comparar</a></li>
							</ul>

							<ul class="product-links">
								<li>Categoría:</li>
								<li><a href="#">Carroceria</a></li>
								<li><a href="#">Transmisiones</a></li>
							</ul>

							<ul class="product-links">
								<li>Compartir:</li>
								<li><a href="#"><i class="fa fa-facebook"></i></a></li>
								<li><a href="#"><i class="fa fa-twitter"></i></a></li>
								<li><a href="#"><i class="fa fa-google-plus"></i></a></li>
								<li><a href="#"><i class="fa fa-envelope"></i></a></li>
							</ul>

						</div>
					</div>
					<!-- /Product details -->

					<!-- Product tab -->
					<div class="col-md-12">
						<div id="product-tab">
							<!-- product tab nav -->
							<ul class="tab-nav">
								<li class="active"><a data-toggle="tab" href="#tab1">Descripcion</a></li>
								<li><a data-toggle="tab" href="#tab2">Detalles</a></li>
								<li><a data-toggle="tab" href="#tab3">Reseñas (3)</a></li>
							</ul>
							<!-- /product tab nav -->

							<!-- product tab content -->
							<div class="tab-content">
								<!-- tab1  -->
								<div id="tab1" class="tab-pane fade-in active">
									<div class="row">
										<div class="col-md-12">
											<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
										</div>
									</div>
								</div>
								<!-- /tab1  -->

								<!-- tab2  -->
								<div id="tab2" class="tab-pane fade-in">
									<div class="row">
										<div class="col-md-12">
											<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
										</div>
									</div>
								</div>
								<!-- /tab2  -->

								<!-- tab3  -->
								<div id="tab3" class="tab-pane fade-in">
									<div class="row">
										<!-- Rating -->
										<div class="col-md-3">
											<div id="rating">
												<div class="rating-avg">
													<span>{{object.rating}}</span>
													<div class="rating-stars">
														{% for score in score_range %}
														<i class="fa fa-star"></i>
														{% endfor %}
														{% for score in score_range_left %}
														<i class="fa fa-star-o"></i>
														{% endfor %}
													</div>
												</div>
												<ul class="rating">
													<li>
														<div class="rating-stars">
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
														</div>
														<div class="rating-progress">
															<div style="width: 80%;"></div>
														</div>
														<span class="sum">3</span>
													</li>
													<li>
														<div class="rating-stars">
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star-o"></i>
														</div>
														<div class="rating-progress">
															<div style="width: 60%;"></div>
														</div>
														<span class="sum">2</span>
													</li>
													<li>
														<div class="rating-stars">
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
														</div>
														<div class="rating-progress">
															<div></div>
														</div>
														<span class="sum">0</span>
													</li>
													<li>
														<div class="rating-stars">
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
														</div>
														<div class="rating-progress">
															<div></div>
														</div>
														<span class="sum">0</span>
													</li>
													<li>
														<div class="rating-stars">
															<i class="fa fa-star"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
															<i class="fa fa-star-o"></i>
														</div>
														<div class="rating-progress">
															<div></div>
														</div>
														<span class="sum">0</span>
													</li>
												</ul>
											</div>
										</div>
										<!-- /Rating -->

										<!-- Reviews -->
										<div class="col-md-6">
											<div id="reviews">

												<div v-if="loading" class="d-flex justify-content-center  align-items-center w-100 mb-5" style="height: 600px;">
													<div class="spinner-border text-danger" style="width: 6rem; height: 6rem;" role="status">
														<span class="sr-only">Loading...</span>
													</div>
												</div>
												<ul v-if="!loading" class="reviews" style="height: 600px;">
												<h4 v-if="!reviews.length"class="my-5">
												Aun no hay reseñas, ¡Sé el primero en añadir una!
												</h4>
													<li class="my-5" v-for="review in reviews">
														<div class="review-heading">
															<h6 v-if="!review.user.first_name && !review.user.last_name" class="name">Usuario sin nombre</h6>
															<h5 v-if="review.user.first_name" class="name">[[review.user.first_name]]</h5>

															<p class="date">[[review.created_at]]</p>
															<div class="review-rating">
																	<i v-for="point in 5" v-bind:class="{'fa fa-star':point <= review.score,'fa fa-star-o empty':point > review.score}" class=""></i>											
															</div>
														</div>
														<div class="review-body">
															<p>[[review.content]]</p>
														</div>
													
												</ul>
												<ul class="reviews-pagination" v-if="reviews.length">
													<li v-for="page in total_pages_review" v-bind:class="{active: page === current_page}"><a @click="fillReviews(page)">[[page]]</a></li>
													<li v-if="next_page_review"><a @click="fillReviews(current_page+1)"><i class="fa fa-angle-right"></i></a></li>
												</ul>
											</div>
										</div>
										<!-- /Reviews -->

										<!-- Review Form -->
										<div class="col-md-3">
											<div id="review-form">
												<form class="review-form">
													<textarea v-model="review_form.message" class="input" placeholder="Tu reseña"></textarea>
													<div class="input-rating">
														<span>Tu valoración: </span>
														<div class="stars">
															<input id="star5" v-model="review_form.score" name="rating" value="5" type="radio"><label for="star5"></label>
															<input id="star4" v-model="review_form.score" name="rating" value="4" type="radio"><label for="star4"></label>
															<input id="star3" v-model="review_form.score" name="rating" value="3" type="radio"><label for="star3"></label>
															<input id="star2" v-model="review_form.score" name="rating" value="2" type="radio"><label for="star2"></label>
															<input id="star1" v-model="review_form.score" name="rating" value="1" type="radio"><label for="star1"></label>
														</div>
													</div>
													<small class="text-danger d-block" v-for="error in this.review_form.errors"><i class="fa fa-warning"></i>  [[error]]</small>
													<button @click="sendReview($event)" type="submit" class="primary-btn">Enviar</button>
												</form>
											</div>
										</div>
										<!-- /Review Form -->
									</div>
								</div>
								<!-- /tab3  -->
							</div>
							<!-- /product tab content  -->
						</div>
					</div>
					<!-- /product tab -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
			
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">

					<div class="col-md-12">
						<div class="section-title text-center">
							<h3 class="title">Productos Relacionados</h3>
						</div>
					</div>

					<!-- product -->
					<div class="col-md-3 col-xs-6">
						<div class="product">
							<div class="product-img">
								<img src="./img/product01.png" alt="">
								<div class="product-label">
									<span class="sale">-30%</span>
								</div>
							</div>
							<div class="product-body">
								<p class="product-category">Categoría</p>
								<h3 class="product-name"><a href="#">Nombre del producto</a></h3>
								<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								<div class="product-rating">
								</div>
								<div class="product-btns">
									<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">Agregar a lista de deseos</span></button>
									<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">Comparar</span></button>
									<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
								</div>
							</div>
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> Agregar al Carrito</button>
							</div>
						</div>
					</div>
					<!-- /product -->

					<!-- product -->
					<div class="col-md-3 col-xs-6">
						<div class="product">
							<div class="product-img">
								<img src="./img/product02.png" alt="">
								<div class="product-label">
									<span class="new">Nuevo</span>
								</div>
							</div>
							<div class="product-body">
								<p class="product-category">Categoría</p>
								<h3 class="product-name"><a href="#">Nombre del producto</a></h3>
								<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								<div class="product-rating">
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
								</div>
								<div class="product-btns">
									<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">Agregar a lista de deseos</span></button>
									<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">Comparar</span></button>
									<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
								</div>
							</div>
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> Agregar al Carrito</button>
							</div>
						</div>
					</div>
					<!-- /product -->

					<!-- product -->
					<div class="col-md-3 col-xs-6">
						<div class="product">
							<div class="product-img">
								<img src="./img/product03.png" alt="">
							</div>
							<div class="product-body">
								<p class="product-category">Categoría</p>
								<h3 class="product-name"><a href="#">Nombre del producto</a></h3>
								<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								<div class="product-rating">
									
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star"></i>
									<i class="fa fa-star-o"></i>
								</div>
								<div class="product-btns">
									<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">Agregar a lista de deseos</span></button>
									<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">Comparar</span></button>
									<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
								</div>
							</div>
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> Agregar al Carrito</button>
							</div>
						</div>
					</div>
					<!-- /product -->

					<!-- product -->
					<div class="col-md-3 col-xs-6">
						<div class="product">
							<div class="product-img">
								<img src="./img/product04.png" alt="">
							</div>
							<div class="product-body">
								<p class="product-category">Categoría</p>
								<h3 class="product-name"><a href="#">Nombre del producto</a></h3>
								<h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
								<div class="product-rating">
								</div>
								<div class="product-btns">
									<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">Agregar a lista de deseos</span></button>
									<button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">Comparar</span></button>
									<button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
								</div>
							</div>
							<div class="add-to-cart">
								<button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> Agregar al Carrito</button>
							</div>
						</div>
					</div>
					<!-- /product -->

				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->

		<!-- Section -->
		
		
	<script>
	const app = new Vue({
		delimiters: ['[[', ']]'],
		el:"#app",
		data(){
			return {
			reviews: [],
			loading: true,
			product_id: null,
			total_pages_review:0,
			next_page_review:null,
			previous_pages_review:null,
			current_page:null,
			review_form:{
				errors:[],
				message: null,
				score: 0,
				product: parseInt("{{object.pk}}")
			}
			}
		},
		mounted(){
			this.fillReviews()
		},
		methods:{
			checkForm(){
				this.review_form.errors = []
				if (this.review_form.product && this.review_form.score > 0 && this.review_form.message){
					return true
				}
				if (!this.review_form.product){
					this.review_form.errors.push("el producto a enviar es inválido")
				}
				if (this.review_form.score <= 0){
					this.review_form.errors.push("la puntuación debe ser mayor a cero")
				}
				if (!this.review_form.message){
					this.review_form.errors.push("la reseña no puede estar vacía")
				}

			},
			fillReviews(page=null){
				this.loading = true
				axios.get("/api/review/?product={{object.id}}", {params:{"page":page}}).then((data)=>{
				this.reviews = data.data.results
				this.total_pages_review = data.data.total_pages
				this.next_page_review = data.data.next
				this.previous_page_review = data.data.previous
				this.current_page = data.data.current_page
				this.loading = false
			})
			},
			sendReview(event){
				event.preventDefault()
				if (!this.checkForm()){
					return false
				}
				console.log(this.review_form)
				axios.defaults.xsrfHeaderName = 'X-CSRFToken'
				axios.defaults.xsrfCookieName = 'csrftoken'
				axios.post("/api/review/", {
					title: null,
					content:this.review_form.message,
					score: this.review_form.score,
					product: 11
			},{withCredentials:true,})
			this.fillReviews()
		}
	}
	})
	</script>


{% endblock %}